<!DOCTYPE html>
<html>
<head>
  <base target="_top">
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ğŸ”§ ãƒ‡ãƒãƒƒã‚°ãƒšãƒ¼ã‚¸</title>
  <style>
    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      padding: 20px;
      background: #f5f5f5;
    }
    .container {
      max-width: 800px;
      margin: 0 auto;
      background: white;
      padding: 30px;
      border-radius: 10px;
      box-shadow: 0 2px 10px rgba(0,0,0,0.1);
    }
    .btn {
      background: #4285f4;
      color: white;
      border: none;
      padding: 10px 20px;
      border-radius: 5px;
      cursor: pointer;
      margin: 5px;
      font-size: 14px;
    }
    .btn:hover {
      background: #3367d6;
    }
    .btn:disabled {
      background: #ccc;
      cursor: not-allowed;
    }
    .log {
      background: #f8f9fa;
      border: 1px solid #e9ecef;
      padding: 15px;
      border-radius: 5px;
      margin: 10px 0;
      font-family: monospace;
      font-size: 12px;
      max-height: 300px;
      overflow-y: auto;
    }
    .success { color: #28a745; }
    .error { color: #dc3545; }
    .info { color: #17a2b8; }
    .form-group {
      margin: 15px 0;
    }
    .form-group label {
      display: block;
      margin-bottom: 5px;
      font-weight: bold;
    }
    .form-group input {
      width: 100%;
      padding: 8px;
      border: 1px solid #ddd;
      border-radius: 4px;
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>ğŸ”§ ãƒ‡ãƒ¼ã‚¿ç®¡ç†ã‚¢ãƒ—ãƒª - ãƒ‡ãƒãƒƒã‚°ãƒšãƒ¼ã‚¸</h1>
    <p>å•é¡Œã®åŸå› ã‚’ç‰¹å®šã™ã‚‹ãŸã‚ã®ãƒ†ã‚¹ãƒˆãƒšãƒ¼ã‚¸ã§ã™ã€‚</p>
    
    <h2>ğŸ“Š åŸºæœ¬æ©Ÿèƒ½ãƒ†ã‚¹ãƒˆ</h2>
    <div>
      <button class="btn" onclick="testGetAllData()">ğŸ“‹ ãƒ‡ãƒ¼ã‚¿å–å¾—ãƒ†ã‚¹ãƒˆ</button>
      <button class="btn" onclick="testCreateSheet()">ğŸ“„ ã‚·ãƒ¼ãƒˆä½œæˆãƒ†ã‚¹ãƒˆ</button>
      <button class="btn" onclick="showSpreadsheetInfo()">ğŸ”— ã‚¹ãƒ—ãƒ¬ãƒƒãƒ‰ã‚·ãƒ¼ãƒˆæƒ…å ±è¡¨ç¤º</button>
      <button class="btn" onclick="clearLog()">ğŸ—‘ï¸ ãƒ­ã‚°ã‚¯ãƒªã‚¢</button>
    </div>

    <h2>ğŸ§ª JSONâ‡”ã‚·ãƒ¼ãƒˆå¤‰æ›ãƒ†ã‚¹ãƒˆ</h2>
    <div class="form-group">
      <label>ç°¡å˜JSON ç”¨ã‚·ãƒ¼ãƒˆå</label>
      <input id="simpleSheetName" value="DEBUG_SIMPLE">
    </div>
    <div class="form-group">
      <label>å¤šã‚±ãƒ¼ã‚¹JSON ç”¨ã‚·ãƒ¼ãƒˆå</label>
      <input id="variousSheetName" value="DEBUG_VARIANTS">
    </div>
    <div>
      <button class="btn" onclick="writeSimple()">â¡ï¸ ç°¡å˜JSON â†’ ã‚·ãƒ¼ãƒˆ</button>
      <button class="btn" onclick="writeVarious()">â¡ï¸ å¤šã‚±ãƒ¼ã‚¹JSON â†’ ã‚·ãƒ¼ãƒˆ</button>
      <button class="btn" onclick="showSamples()">ğŸ‘€ ã‚µãƒ³ãƒ—ãƒ«JSONè¡¨ç¤º</button>
    </div>
    <div class="form-group">
      <label>èª­ã¿æˆ»ã—å¯¾è±¡ã‚·ãƒ¼ãƒˆå</label>
      <input id="readSheetName" value="DEBUG_SIMPLE">
    </div>
    <div>
      <button class="btn" onclick="readBack()">â¬…ï¸ ã‚·ãƒ¼ãƒˆ â†’ JSON</button>
    </div>
    
    
    
    <h2>ğŸ“ ãƒ­ã‚°å‡ºåŠ›</h2>
    <div id="logArea" class="log">
      <div class="info">ãƒ­ã‚°ãŒè¡¨ç¤ºã•ã‚Œã¾ã™...</div>
    </div>
    
    <h2>ğŸ“– ãƒˆãƒ©ãƒ–ãƒ«ã‚·ãƒ¥ãƒ¼ãƒ†ã‚£ãƒ³ã‚°æ‰‹é †</h2>
    <ol>
      <li><strong>ã€Œãƒ‡ãƒ¼ã‚¿å–å¾—ãƒ†ã‚¹ãƒˆã€</strong>ã‚’ã‚¯ãƒªãƒƒã‚¯ã—ã¦ã€åŸºæœ¬æ©Ÿèƒ½ãŒå‹•ä½œã™ã‚‹ã‹ç¢ºèª</li>
      <li><strong>ã€Œã‚·ãƒ¼ãƒˆä½œæˆãƒ†ã‚¹ãƒˆã€</strong>ã§ã‚¹ãƒ—ãƒ¬ãƒƒãƒ‰ã‚·ãƒ¼ãƒˆãŒæ­£å¸¸ã«ä½œæˆã•ã‚Œã‚‹ã‹ç¢ºèª</li>
      <li><strong>ã€Œãƒ†ã‚¹ãƒˆãƒ‡ãƒ¼ã‚¿è¿½åŠ ã€</strong>ã§æ–°è¦ãƒ‡ãƒ¼ã‚¿è¿½åŠ ãŒå‹•ä½œã™ã‚‹ã‹ç¢ºèª</li>
      <li>ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ãŸå ´åˆã€ãƒ­ã‚°ã®å†…å®¹ã‚’ç¢ºèªã—ã¦ãã ã•ã„</li>
    </ol>
    
    <h2>ğŸ”§ ã‚ˆãã‚ã‚‹å•é¡Œã¨è§£æ±ºæ–¹æ³•</h2>
    <ul>
      <li><strong>æ¨©é™ã‚¨ãƒ©ãƒ¼</strong>: Google Apps Scriptã®å®Ÿè¡Œæ¨©é™ã‚’ç¢ºèªã—ã¦ãã ã•ã„</li>
      <li><strong>ã‚¹ãƒ—ãƒ¬ãƒƒãƒ‰ã‚·ãƒ¼ãƒˆã‚¨ãƒ©ãƒ¼</strong>: æ–°ã—ã„ã‚¹ãƒ—ãƒ¬ãƒƒãƒ‰ã‚·ãƒ¼ãƒˆãŒè‡ªå‹•ä½œæˆã•ã‚Œã¾ã™</li>
      <li><strong>ã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆ</strong>: å‡¦ç†ã«æ™‚é–“ãŒã‹ã‹ã£ã¦ã„ã‚‹å¯èƒ½æ€§ãŒã‚ã‚Šã¾ã™</li>
    </ul>
  </div>

  <script>
    // ãƒ­ã‚°å‡ºåŠ›é–¢æ•°
    function log(message, type = 'info') {
      const logArea = document.getElementById('logArea');
      const timestamp = new Date().toLocaleTimeString();
      const className = type === 'success' ? 'success' : type === 'error' ? 'error' : 'info';
      
      logArea.innerHTML += `<div class="${className}">[${timestamp}] ${message}</div>`;
      logArea.scrollTop = logArea.scrollHeight;
      
      console.log(`[${type.toUpperCase()}] ${message}`);
    }
    
    // ãƒ­ã‚°ã‚¯ãƒªã‚¢
    function clearLog() {
      document.getElementById('logArea').innerHTML = '<div class="info">ãƒ­ã‚°ãŒã‚¯ãƒªã‚¢ã•ã‚Œã¾ã—ãŸ...</div>';
    }
    
    // ãƒ‡ãƒ¼ã‚¿å–å¾—ãƒ†ã‚¹ãƒˆ
    function testGetAllData() {
      log('ãƒ‡ãƒ¼ã‚¿å–å¾—ãƒ†ã‚¹ãƒˆã‚’é–‹å§‹...', 'info');
      
      google.script.run
        .withSuccessHandler((result) => {
          if (result && result.length != null) {
            log(`ãƒ‡ãƒ¼ã‚¿å–å¾—æˆåŠŸ: ${result.length}ä»¶ã®ãƒ‡ãƒ¼ã‚¿`, 'success');
            if (result.length > 0) log(`æœ€åˆã®ãƒ‡ãƒ¼ã‚¿: ${JSON.stringify(result[0])}`, 'info');
          } else {
            log('ãƒ‡ãƒ¼ã‚¿å–å¾—: ãƒ‡ãƒ¼ã‚¿ãªã—(null)', 'info');
          }
        })
        .withFailureHandler((error) => {
          log(`ãƒ‡ãƒ¼ã‚¿å–å¾—ã‚¨ãƒ©ãƒ¼: ${error.message}`, 'error');
        })
        .getAllDataSafe();
    }
    
    // ã‚·ãƒ¼ãƒˆä½œæˆãƒ†ã‚¹ãƒˆ
    function testCreateSheet() {
      log('ã‚·ãƒ¼ãƒˆä½œæˆãƒ†ã‚¹ãƒˆã‚’é–‹å§‹...', 'info');
      
      google.script.run
        .withSuccessHandler((result) => {
          log(`ã‚·ãƒ¼ãƒˆä½œæˆæˆåŠŸ: ${result}`, 'success');
        })
        .withFailureHandler((error) => {
          log(`ã‚·ãƒ¼ãƒˆä½œæˆã‚¨ãƒ©ãƒ¼: ${error.message}`, 'error');
        })
        .testCreateDataSheet();
    }
    
    // JSONâ‡”ã‚·ãƒ¼ãƒˆå¤‰æ›ãƒ†ã‚¹ãƒˆ
    function writeSimple() {
      const name = document.getElementById('simpleSheetName').value.trim();
      log(`ç°¡å˜JSONã‚’æ›¸ãè¾¼ã¿ä¸­... (sheet=${name})`, 'info');
      google.script.run
        .withSuccessHandler((res) => {
          log(`æ›¸ãè¾¼ã¿æˆåŠŸ: rows=${res.write.rows} cols=${res.write.cols}`, 'success');
          if (res.sheet && res.sheet.url) log(`ã‚¹ãƒ—ãƒ¬ãƒƒãƒ‰ã‚·ãƒ¼ãƒˆ: ${res.sheet.url}`, 'info');
        })
        .withFailureHandler((err) => log(`æ›¸ãè¾¼ã¿å¤±æ•—: ${err.message||err}`, 'error'))
        .debugWriteSample('simple', name);
    }

    function writeVarious() {
      const name = document.getElementById('variousSheetName').value.trim();
      log(`å¤šã‚±ãƒ¼ã‚¹JSONã‚’æ›¸ãè¾¼ã¿ä¸­... (sheet=${name})`, 'info');
      google.script.run
        .withSuccessHandler((res) => {
          log(`æ›¸ãè¾¼ã¿æˆåŠŸ: rows=${res.write.rows} cols=${res.write.cols}`, 'success');
          if (res.sheet && res.sheet.url) log(`ã‚¹ãƒ—ãƒ¬ãƒƒãƒ‰ã‚·ãƒ¼ãƒˆ: ${res.sheet.url}`, 'info');
        })
        .withFailureHandler((err) => log(`æ›¸ãè¾¼ã¿å¤±æ•—: ${err.message||err}`, 'error'))
        .debugWriteSample('various', name);
    }

    function readBack() {
      const name = document.getElementById('readSheetName').value.trim();
      log(`èª­ã¿æˆ»ã—ä¸­... (sheet=${name})`, 'info');
      google.script.run
        .withSuccessHandler((rows) => {
          log(`èª­ã¿æˆ»ã—æˆåŠŸ: ${rows.length}ä»¶`, 'success');
          if (rows.length) log(`å…ˆé ­: ${JSON.stringify(rows[0], null, 2)}`, 'info');
        })
        .withFailureHandler((err) => log(`èª­ã¿æˆ»ã—å¤±æ•—: ${err.message||err}`, 'error'))
        .debugReadSheet(name);
    }

    function showSamples() {
      log('ã‚µãƒ³ãƒ—ãƒ«JSONã‚’å–å¾—ä¸­...', 'info');
      google.script.run
        .withSuccessHandler((o) => {
          log('ç°¡å˜JSON = ' + JSON.stringify(o.simple, null, 2), 'info');
          log('å¤šã‚±ãƒ¼ã‚¹JSON = ' + JSON.stringify(o.various, null, 2), 'info');
        })
        .withFailureHandler((err) => log(`ã‚µãƒ³ãƒ—ãƒ«å–å¾—å¤±æ•—: ${err.message||err}`, 'error'))
        .debugJsonSamples();
    }
    
    // ã‚¹ãƒ—ãƒ¬ãƒƒãƒ‰ã‚·ãƒ¼ãƒˆæƒ…å ±è¡¨ç¤º
    function showSpreadsheetInfo() {
      log('ã‚¹ãƒ—ãƒ¬ãƒƒãƒ‰ã‚·ãƒ¼ãƒˆæƒ…å ±ã‚’å–å¾—ä¸­...', 'info');
      google.script.run
        .withSuccessHandler((result) => {
          if (result.success && result.spreadsheetInfo) {
            const info = result.spreadsheetInfo;
            log(`ã‚¹ãƒ—ãƒ¬ãƒƒãƒ‰ã‚·ãƒ¼ãƒˆå: ${info.name}`, 'success');
            log(`ã‚¹ãƒ—ãƒ¬ãƒƒãƒ‰ã‚·ãƒ¼ãƒˆID: ${info.id}`, 'info');
            log(`ğŸ“‹ ã‚¹ãƒ—ãƒ¬ãƒƒãƒ‰ã‚·ãƒ¼ãƒˆURL: ${info.url}`, 'success');
            log(`ğŸ“„ ã‚·ãƒ¼ãƒˆæ•°: ${info.sheets.length}å€‹ (${info.sheets.join(', ')})`, 'info');
          } else {
            log(`ã‚¹ãƒ—ãƒ¬ãƒƒãƒ‰ã‚·ãƒ¼ãƒˆæƒ…å ±å–å¾—å¤±æ•—: ${result.error || 'ä¸æ˜ãªã‚¨ãƒ©ãƒ¼'}`, 'error');
          }
        })
        .withFailureHandler((error) => {
          log(`ã‚¹ãƒ—ãƒ¬ãƒƒãƒ‰ã‚·ãƒ¼ãƒˆæƒ…å ±å–å¾—ã‚¨ãƒ©ãƒ¼: ${error.message}`, 'error');
        })
        .debugSpreadsheetInfo();
    }
    
    // åˆæœŸåŒ–
    document.addEventListener('DOMContentLoaded', function() {
      log('ãƒ‡ãƒãƒƒã‚°ãƒšãƒ¼ã‚¸ãŒèª­ã¿è¾¼ã¾ã‚Œã¾ã—ãŸ', 'success');
      log('ã¾ãšã€Œã‚¹ãƒ—ãƒ¬ãƒƒãƒ‰ã‚·ãƒ¼ãƒˆæƒ…å ±è¡¨ç¤ºã€ã§ã‚·ãƒ¼ãƒˆURLã‚’ç¢ºèªã—ã¦ãã ã•ã„', 'info');
      log('ãã®å¾Œã€Œãƒ‡ãƒ¼ã‚¿å–å¾—ãƒ†ã‚¹ãƒˆã€ã‚’å®Ÿè¡Œã—ã¦ãã ã•ã„', 'info');
    });
  </script>
</body>
</html>
