# 受付データ管理システム 要件定義書

## はじめに

このドキュメントは、Google Apps Scriptで構築された受付データ管理Webアプリケーションの現状機能と要件を整理したものです。本システムは、AppSheetのようなノーコード感覚で使える受付データ管理を目的として開発されています。

## 要件

### 要件1: 受付データの入力・管理機能

**ユーザーストーリー:** 受付担当者として、相談者からの問い合わせ内容を構造化されたフォームで入力・管理したい。これにより、受付業務の効率化と情報の標準化を実現したい。

#### 受入基準

1. WHEN 受付担当者が新規受付フォームにアクセスした時 THEN システムは階層構造に対応した入力フォームを表示する
2. WHEN 受付担当者が受付メタ情報（受付日、担当者、区、連絡方法等）を入力した時 THEN システムは入力内容を適切に保存する
3. WHEN 受付担当者が相談対象を「A:生物」「B:アセス」「C:その他」から選択した時 THEN システムは選択に応じた詳細入力項目を動的に表示する
4. WHEN 相談対象が「A:生物」の場合 THEN システムは生物カテゴリ（哺乳類、鳥類、甲殻類・昆虫類等）の階層選択を可能にする
5. WHEN 相談種類を選択する時 THEN システムは「一般論的相談」「個別案件相談」「その他」の階層構造での複数選択を可能にする
6. WHEN 個別案件相談を選択した時 THEN システムは「生活環境被害」「生態系かく乱」「傷病鳥獣」等のサブカテゴリ選択を可能にする
7. WHEN 対応種別を入力する時 THEN システムは「委託での駆除対応」「他の機関等を紹介・依頼」等の選択肢を提供する
8. WHEN 追加対応が必要な場合 THEN システムは複数の追加対応項目（日時、内容）の入力を可能にする

### 要件2: データ検索・一覧表示機能

**ユーザーストーリー:** 管理者として、蓄積された受付データを効率的に検索・閲覧したい。これにより、過去の対応履歴の確認や統計分析を行いたい。

#### 受入基準

1. WHEN 管理者がWebアプリのメインページにアクセスした時 THEN システムは受付データの一覧を表形式で表示する
2. WHEN 管理者が検索ボックスにキーワードを入力した時 THEN システムはリアルタイムで該当データをフィルタリング表示する
3. WHEN 管理者が高度検索構文（フィールド指定、正規表現、日時比較）を使用した時 THEN システムは適切な検索結果を返す
4. WHEN 検索結果が表示された時 THEN システムは「ID、受付日、対象、担当、区、問い合わせ方法、相談種類、対応種類、詳細、作成日時、更新日時」の列を表示する
5. WHEN 管理者が特定のデータ行の「編集」ボタンをクリックした時 THEN システムは該当データの編集フォームを表示する
6. WHEN データが存在しない場合 THEN システムは適切な空状態メッセージを表示する

### 要件3: データ永続化・同期機能

**ユーザーストーリー:** システム利用者として、入力したデータが確実にGoogleスプレッドシートに保存され、リアルタイムで同期されることを期待する。これにより、データの紛失リスクを回避し、複数人での情報共有を実現したい。

#### 受入基準

1. WHEN 受付データが保存される時 THEN システムは多段ヘッダー（4段固定）形式でスプレッドシートに書き込む
2. WHEN 新規データが保存される時 THEN システムは自動的にIDを採番し、作成日時・更新日時を記録する
3. WHEN 既存データが更新される時 THEN システムは更新日時を自動更新し、IDは変更しない
4. WHEN データ構造に新しいフィールドが追加された時 THEN システムは動的に列を追加し、既存データとの整合性を保つ
5. WHEN スプレッドシートが存在しない場合 THEN システムは「受付データ」シートを自動作成する
6. WHEN データの読み込みでエラーが発生した時 THEN システムは適切なエラーメッセージを表示し、デバッグ情報を提供する

### 要件4: ユーザーインターフェース・操作性

**ユーザーストーリー:** エンドユーザーとして、直感的で使いやすいインターフェースでシステムを操作したい。これにより、ITスキルに関係なく効率的に業務を遂行したい。

#### 受入基準

1. WHEN ユーザーがモバイルデバイスからアクセスした時 THEN システムはレスポンシブデザインで最適化された画面を表示する
2. WHEN ユーザーがフォーム入力中にエラーが発生した時 THEN システムは分かりやすいエラーメッセージを表示する
3. WHEN ユーザーがデータ保存を実行した時 THEN システムは保存中の状態を視覚的に表示し、完了時に成功メッセージを表示する
4. WHEN ユーザーが長時間の処理を実行した時 THEN システムはタイムアウト処理（30秒）を実装し、適切なメッセージを表示する
5. WHEN ユーザーが検索機能を使用した時 THEN システムは検索結果件数を「X / Y 件」形式で表示する
6. WHEN ユーザーがデバッグページにアクセスした時 THEN システムは問題診断のためのテスト機能を提供する

### 要件5: システム管理・保守機能

**ユーザーストーリー:** システム管理者として、アプリケーションの動作状況を監視し、問題が発生した際に迅速に対応したい。これにより、システムの安定稼働を維持したい。

#### 受入基準

1. WHEN 管理者がデバッグページにアクセスした時 THEN システムはスプレッドシート情報、データ取得テスト、シート作成テストの機能を提供する
2. WHEN システムエラーが発生した時 THEN システムはコンソールログに詳細なエラー情報を出力する
3. WHEN 管理者がサーバー疎通テストを実行した時 THEN システムはGoogle Apps Scriptとの接続状況を確認・報告する
4. WHEN データの整合性に問題がある時 THEN システムは適切な警告メッセージを表示し、修復手順を提示する
5. WHEN 新しいバージョンがデプロイされた時 THEN システムはバージョン情報を画面に表示する
6. WHEN 管理者がログを確認する時 THEN システムはタイムスタンプ付きの詳細ログを提供する